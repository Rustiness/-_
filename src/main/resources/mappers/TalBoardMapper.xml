<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="talentBoard">
	<!-- -->
	<insert id="create">
		INSERT INTO TalentBoard (talDocNO, memNO, title, contentHave, contentWant, excCalls, views, STATE)
		VALUES ('TB_A' || LPAD(TalentBoard_seq.nextval, 5, 0), 'MEM_A00001', #{title}, #{contentHave}, #{contentWant}, 0, 0, 2)
	</insert>

	<!-- -->
	<update id="update">
		UPDATE TalentBoard
		SET title = #{title},
			contentHave = #{contentHave},
			contentWant = #{contentWant},
			repairDate = sysdate
		WHERE talDocNO = #{talDocNO}
	</update>

	<!-- -->
	<delete id="delete">
		DELETE FROM talentlist
		WHERE writeNO = #{writeNO}
	</delete>

	<!-- 특정게시물 읽기 -->
	<select id="read" resultType="talentlist">
		SELECT nickName, writeDate, contentHave, excCalls, contentWant, title
		FROM TalentBoard, Member
		WHERE TalentBoard.memNO = Member.memNO
			AND talDocNO = #{talDocNO}
	</select>

	<!-- 리스트 -->
	<select id="listAll" resultType="talentlist">
		<!-- select bno,title,content,writer,redate,viewcnt from tbl_board order by bno desc -->
		<![CDATA[
			SELECT talDocNO, title, contentHave, contentWant, writeDate, memNO
			FROM TalentBoard ORDER BY talDocNO DESC
		]]>
	</select>

	<!-- -->
	<select id="listPage" resultType="talentlist">
		SELECT talDocNO, title, contentHave, contentWant, writeDate, memNO
		FROM TalentBoard
		ORDER BY talDocNO DESC
	</select>

	<!-- -->
	<select id="countPaging" resultType="int">
		SELECT count(*)
		FROM TalentBoard
	</select>

	<!-- 검색어 조회1 -->
	<sql id="search">
		<if test="searchType == 'all'.toString()">
			AND ((title LIKE '%'||#{keyword}||'%')
			OR (contentHave LIKE '%'||#{keyword}||'%')
			OR (contentWant LIKE '%'||#{keyword}||'%')
			OR (nickName LIKE '%'||#{keyword}||'%' ))
		</if>
		<if test="searchType == 't'.toString()">
			AND title LIKE '%'||#{keyword}||'%'
		</if>
		<if test="searchType == 'c'.toString()">
			AND (contentHave LIKE '%'||#{keyword}||'%' OR contentWant LIKE
			'%'||#{keyword}||'%')
		</if>
		<if test="searchType == 'w'.toString()">
			AND nickName LIKE '%'||#{keyword}||'%'
		</if>
	</sql>

	<!-- -->
	<select id="listSearch" resultType="talentlist">
		SELECT talDocNO, title, contentHave, contentWant, writeDate, nickName, TalentBoard.memNO
		FROM TalentBoard, Member
		WHERE TalentBoard.memNO = Member.memNO
		<include refid="search"></include>
		order by talDocNO desc
	</select>

	<!-- -->
	<select id="listSearchCount" resultType="int">
		SELECT count(*) FROM TalentBoard, Member
		WHERE TalentBoard.memNO = Member.memNO
		<include refid="search"></include>
	</select>

	<!-- 카테고리 조회 -->
	<select id="categoryList" resultType="talCategory">
		SELECT * FROM DF_TALCATEGORY
	</select>

	<!-- -->
	<select id="divList" resultType="taldiv">
		SELECT * FROM DF_TalDiv
	</select>
</mapper>
