<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="rboard">

	<!-- 후기 입력하기 -->
	<insert id="create">
		INSERT INTO TalReview (talReviewNO, talConnNO, title, content, writeDate)
		VALUES ('TE_A' || LPAD(TalReview_seq.nextval, 5, 0), 'TEC_A00005', #{title}, #{content}, sysdate)
	</insert>

	<!-- 후기 게시판 전체목록보기 -->
	<select id="listAll" resultType="rboard">
		SELECT talReviewNO, title, content, writeDate
		FROM TalReview
		ORDER BY talReviewNO DESC
	</select>

	<!-- 게시물 상세읽기 -->
	<select id="read" resultType="rboard">
		SELECT talReviewNO, title, content, writeDate
		FROM TalReview
		WHERE talReviewNO = #{talReviewNO}
	</select>

	<!-- <select id="nickname"> select nickname from member where memno= (select 
		memNO from TalExcConn where talConnNo = (select talConnNO from TalExchange 
		where talReviewNO=#{talReviewNO})) </select> -->

	<!-- 게시물 수정 -->
	<update id="update">
		update TalReview set title=#{title}, content=#{content}
		where talReviewNO=#{talReviewNO}
	</update>

	<!-- 게시물 삭제 -->
	<delete id="delete">
		delete from TalReview where talReviewNO=#{talReviewNO}
	</delete>

	<!--  검색어 조회 -->
	<sql id="search">
		<if test="searchType !=null">
			<if test="searchType == 't'.toString()">
				AND e.title LIKE '%'||#{keyword}||'%'
			</if>
			<if test="searchType == 'c'.toString()">
				AND e.content LIKE '%'||#{keyword}||'%'
			</if>
			<if test="searchType == 'w'.toString()">
				AND nickname LIKE '%'||#{keyword}||'%'
			</if>
		</if>
	</sql>

		<!-- 검색어 조회 -->
	<sql id="search2">
		<if test="searchType !=null">
			<if test="searchType == 't'.toString()">
				where e.title like '%'||#{keyword}||'%'
			</if>
			<if test="searchType == 'c'.toString()">
				where e.content like '%'||#{keyword}||'%'
			</if>
			<if test="searchType == 'w'.toString()">
				where nickname like '%'||#{keyword}||'%'
			</if>
		</if>
	</sql>

	<!-- 전체리스트 검색하기(카테고리, 닉네임 조회때문에 복잡해짐 -_- -->
	<select id="listSearch" resultType="rboard">
		select e.talReviewNO, e.title, e.content, m.nickName, e.writeDate,f.name
		from TalReview e,TalExcConn c,member m,TalentBoard t,NP_TalHave n,DF_TalDiv f
		where n.talDivDF = f.talDivDF <!--DF_재능항목+보유한재능(작성자)  -->
		and e.talConnNO = c.talConnNO <!--재능교환(후기)+재능연결  -->
		and n.talDocNO = t.talDocNO <!--재능연결+재능글  -->
		and t.talDocNO = c.talDocNO <!--재능글+보유한재능 -->
		and c.memNO = m.memNO <!--재능연걸+회원  -->
		<include refid="search"></include>
		order by e.talReviewNO desc
	</select>

	<!-- 전체글갯수 확인하기 -->
	<select id="countPaging" resultType="int">
		SELECT count(*) FROM TalReview
	</select>

	<!-- 검색으로 찾은 목록 갯수 확인하기 -->
	<select id="listSearchCount" resultType="int">
		select count(*) from TalReview
		<include refid="search2"></include>
	</select>

	<!-- <select id="nickname" resultType="int">
	select nickname
	from member
	where memno= (select  memNO
					from TalExcConn
					where talConnNo = (select talConnNO
										from TalReview
										where talReviewNO='TE_A00001'))
	</select> -->
</mapper>




